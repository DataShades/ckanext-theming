{%- macro form_block(method="GET", action="", enctype="", include_csrf=true) -%}
    {{ ui.form_start(method, action, enctype, **kwargs) }}
    {{ h.csrf_input() if include_csrf and method|upper != "GET" }}

    {{ caller() }}

    {{ ui.form_end() }}
{%- endmacro %}

{%- macro form(content, method, action, enctype, include_csrf=true) -%}
    {{ ui.form_start(method, action, enctype, **kwargs) }}
    {{ h.csrf_input() if include_csrf and method|upper != "GET" }}
    {{ content }}
    {{ ui.form_end() }}
{%- endmacro %}

{%- macro form_actions(content) -%}
    <div {{ ui.util.attrs(kwargs) }} class="flex items-center justify-between pt-6">
        {{ content }}
    </div>
{%- endmacro %}

{%- macro form_start(method, action="", enctype="") -%}
    <form {{ ui.util.attrs(kwargs) }} method="{{ method }}" action="{{ action }}" enctype="{{ enctype }}" class="space-y-6">
{%- endmacro %}

{%- macro form_end() -%}
    {%- do kwargs -%}
    </form>
{%- endmacro %}

{%- macro form_errors(errors={}) -%}
    {% if errors %}
        <div {{ ui.util.attrs(kwargs) }} class="p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg" role="alert">
            <p>{{ _('The form contains invalid entries:') }}</p>
            <ul class="mt-2 list-disc pl-5 space-y-1">
                {% for key, error in errors.items() %}
                    <li>{% if key %}{{ key }}: {% endif %}{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
{%- endmacro %}

{% macro input(name, id, label="", value="", type="text", errors=[], required=false) -%}
    {%- set id = id or "field-" ~ name if name else "" -%}

    <div {{ ui.util.attrs(kwargs) }} class="mb-4">
        {%- if label -%}
            <label for="{{ id }}" class="block mb-2 text-sm font-medium text-gray-700">
                {{ label }}
                {%- if required %}<span class="text-red-500">*</span>{%- endif %}
            </label>
        {%- endif %}
        <input type="{{ type }}"
               name="{{ name }}"
               id="{{ id }}"
               value="{{ value }}"
               class="{{ 'border-red-500 focus:border-red-500 focus:ring-red-500' if errors else 'border-gray-300 focus:border-blue-500 focus:ring-blue-500' }} block w-full px-3 py-2 mt-1 border rounded-md shadow-sm sm:text-sm"
               {{ "required" if required }} />
        {%- if errors -%}
            {%- for error in errors -%}
                <p class="mt-2 text-sm text-red-600">{{ error }}</p>
            {%- endfor %}
        {%- endif %}
    </div>
{%- endmacro %}

{%- macro hidden_input(name, value) -%}
    <input {{ ui.util.attrs(kwargs) }} type="hidden" name="{{ name }}" value="{{ value }}">
{%- endmacro %}

{% macro checkbox(name, id, label="", value="on", checked=false, errors=[], required=false) %}
    {%- set id = id or "field-" ~ name if name else "" -%}

    <div {{ ui.util.attrs(kwargs) }} class="mb-4">
        <div class="flex items-start">
            <div class="flex items-center h-5">
                <input type="checkbox"
                       name="{{ name }}"
                       id="{{ id }}"
                       value="{{ value }}"
                       class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                       {{ "checked" if checked }}
                       {{ "required" if required }} />
            </div>
            <div class="ml-3 text-sm">
                <label for="{{ id }}" class="font-medium text-gray-700">
                    {{ label }}
                    {%- if required %}<span class="text-red-500">*</span>{%- endif %}
                </label>
                {%- if errors -%}
                    {%- for error in errors -%}
                        <p class="mt-1 text-sm text-red-600">{{ error }}</p>
                    {%- endfor %}
                {%- endif %}
            </div>
        </div>
    </div>
{%- endmacro %}

{%- macro textarea(name, id, label="", value="", errors=[], required=false) -%}
    {%- set id = id or "field-" ~ name if name else "" -%}

    <div {{ ui.util.attrs(kwargs) }} class="mb-4">
        {%- if label -%}
            <label for="{{ id }}" class="block mb-2 text-sm font-medium text-gray-700">
                {{ label }}
                {%- if required %}<span class="text-red-500">*</span>{%- endif %}
            </label>
        {%- endif %}
        <textarea name="{{ name }}"
                  id="{{ id }}"
                  rows="4"
                  class="{{ 'border-red-500 focus:border-red-500 focus:ring-red-500' if errors else 'border-gray-300 focus:border-blue-500 focus:ring-blue-500' }} block w-full px-3 py-2 mt-1 border rounded-md shadow-sm sm:text-sm"
                  {{ "required" if required }}>{{ value }}</textarea>
        {%- if errors -%}
            {%- for error in errors -%}
                <p class="mt-2 text-sm text-red-600">{{ error }}</p>
            {%- endfor %}
        {%- endif %}
    </div>
{%- endmacro %}

{%- macro submit(value, name) -%}
    {%- do kwargs.setdefault("attrs", {}).setdefault("name", name) -%}
    {{ ui.button(value, type="submit", **kwargs) }}
{%- endmacro %}

{%- macro select(name, id, label="", options=[], selected=None, errors=[], required=false) -%}
    {%- set id = id or "field-" ~ name if name else "" -%}

    <div {{ ui.util.attrs(kwargs) }} class="mb-4">
        {%- if label -%}
            <label for="{{ id }}" class="block mb-2 text-sm font-medium text-gray-700">
                {{ label }}
                {%- if required %}<span class="text-red-500">*</span>{%- endif %}
            </label>
        {%- endif %}
        <select name="{{ name }}"
                id="{{ id }}"
                class="{{ 'border-red-500 focus:border-red-500 focus:ring-red-500' if errors else 'border-gray-300 focus:border-blue-500 focus:ring-blue-500' }} block w-full px-3 py-2 mt-1 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                {{ "required" if required }}>
            {%- for option in options %}
                {%- if option is string %}
                    <option value="{{ option }}" {{ "selected" if option == selected }}>{{ option }}</option>
                {%- else %}
                    <option value="{{ option.value }}" {{ "selected" if option.value == selected }}>{{ option.text or option.value }}</option>
                {%- endif %}
            {%- endfor %}
        </select>
        {%- if errors -%}
            {%- for error in errors -%}
                <p class="mt-2 text-sm text-red-600">{{ error }}</p>
            {%- endfor %}
        {%- endif %}
    </div>
{%- endmacro %}

{%- macro radio(name, id, label="", value="on", checked=false, errors=[], required=false) -%}
    {%- set id = id or "field-" ~ name if name else "" -%}

    <div {{ ui.util.attrs(kwargs) }} class="mb-4">
        <div class="flex items-center">
            <input type="radio"
                   name="{{ name }}"
                   id="{{ id }}"
                   value="{{ value }}"
                   class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"
                   {{ "checked" if checked }}
                   {{ "required" if required }} />
            <label for="{{ id }}" class="block ml-2 text-sm font-medium text-gray-700">
                {{ label }}
                {%- if required %}<span class="text-red-500">*</span>{%- endif %}
            </label>
        </div>
        {%- if errors -%}
            {%- for error in errors -%}
                <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {%- endfor %}
        {%- endif %}
    </div>
{%- endmacro %}

{%- macro file_input(name, id, label="", errors=[], required=false) -%}
    {%- set id = id or "field-" ~ name if name else "" -%}

    <div {{ ui.util.attrs(kwargs) }} class="mb-4">
        {%- if label -%}
            <label class="block mb-2 text-sm font-medium text-gray-700">
                {{ label }}
                {%- if required %}<span class="text-red-500">*</span>{%- endif %}
            </label>
        {%- endif %}
        <div class="mt-1">
            <label class="flex justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                <span>Choose File</span>
                <input type="file"
                       name="{{ name }}"
                       id="{{ id }}"
                       class="sr-only"
                       {{ "required" if required }} />
            </label>
        </div>
        {%- if errors -%}
            {%- for error in errors -%}
                <p class="mt-2 text-sm text-red-600">{{ error }}</p>
            {%- endfor %}
        {%- endif %}
    </div>
{%- endmacro %}

{%- macro range_input(name, id, label="", value=0, min=0, max=100, errors=[], required=false) -%}
    {%- set id = id or "field-" ~ name if name else "" -%}

    <div {{ ui.util.attrs(kwargs) }} class="mb-4">
        {%- if label -%}
            <label for="{{ id }}" class="block mb-2 text-sm font-medium text-gray-700">
                {{ label }}
                {%- if required %}<span class="text-red-500">*</span>{%- endif %}
            </label>
        {%- endif %}
        <div class="flex items-center">
            <input type="range"
                   name="{{ name }}"
                   id="{{ id }}"
                   value="{{ value }}"
                   min="{{ min }}"
                   max="{{ max }}"
                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                   {{ "required" if required }} />
            <span class="ml-4 text-sm text-gray-600">{{ value }}</span>
        </div>
        {%- if errors -%}
            {%- for error in errors -%}
                <p class="mt-2 text-sm text-red-600">{{ error }}</p>
            {%- endfor %}
        {%- endif %}
    </div>
{%- endmacro %}

{%- macro toggle_switch(name, id, label="", value="on", checked=false, errors=[], required=false) -%}
    {%- set id = id or "field-" ~ name if name else "" -%}

    <div {{ ui.util.attrs(kwargs) }} class="mb-4">
        <div class="flex items-center justify-between">
            <label for="{{ id }}" class="block text-sm font-medium text-gray-700">
                {{ label }}
                {%- if required %}<span class="text-red-500">*</span>{%- endif %}
            </label>
            <button type="button" class="relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 bg-blue-600" role="switch" aria-checked="{{ 'true' if checked else 'false' }}">
                <span class="sr-only">Toggle</span>
                <span aria-hidden="true" class="{{ 'translate-x-5' if checked else 'translate-x-0' }} pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"></span>
            </button>
            <input type="hidden" name="{{ name }}" id="{{ id }}" value="{{ value if checked else 'off' }}">
        </div>
        {%- if errors -%}
            {%- for error in errors -%}
                <p class="mt-2 text-sm text-red-600">{{ error }}</p>
            {%- endfor %}
        {%- endif %}
    </div>
{%- endmacro %}
