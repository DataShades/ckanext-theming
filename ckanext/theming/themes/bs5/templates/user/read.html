{% extends "user/base.html" %}

{%- block subtitle %}{{ user_dict.display_name }}{% endblock -%}

{%- block breadcrumb_content %}
    {{ ui.breadcrumb_item(_('Users'), h.url_for('user.index')) }}
    {{ ui.breadcrumb_item(user_dict.display_name, h.url_for('user.read', id=user_dict.name)) }}
{%- endblock -%}

{%- block primary_content_inner %}
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        {{ ui.avatar(user_dict.image_display_url, user_dict.display_name, class="me-3") }}
                        <div>
                            <h4 class="mb-1">{{ user_dict.display_name }}</h4>
                            <p class="text-muted mb-1">@{{ user_dict.name }}</p>
                            {%- if user_dict.about %}
                                <p class="mb-0">{{ user_dict.about }}</p>
                            {%- endif %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <h6>{{ _('Member Since') }}</h6>
                            <p>{{ ui.datetime(user_dict.created) }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6>{{ _('Last Active') }}</h6>
                            <p>{{ ui.datetime(user_dict.last_active) if user_dict.last_active else _('Not available') }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">{{ _('User Activity') }}</h5>
                </div>
                <div class="card-body">
                    {%- if c.user_activity_stream %}
                        {{ c.user_activity_stream }}
                    {%- else %}
                        <p class="text-muted">{{ _('No activity') }}</p>
                    {%- endif %}
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">{{ _('Statistics') }}</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <strong>{{ _('Datasets') }}:</strong>
                            <span class="badge bg-primary">{{ user_dict.number_created_packages or 0 }}</span>
                        </li>
                        <li class="list-group-item">
                            <strong>{{ _('Followers') }}:</strong>
                            <span class="badge bg-secondary">{{ user_dict.number_of_followers or 0 }}</span>
                        </li>
                        <li class="list-group-item">
                            <strong>{{ _('Following') }}:</strong>
                            <span class="badge bg-info">{{ user_dict.number_organizations_followed|default(0) + user_dict.number_groups_followed|default(0) + user_dict.number_followed_datasets|default(0) }}</span>
                        </li>
                    </ul>

                    <div class="mt-3">
                        {%- if h.check_access('user_update', {'id': user_dict.id}) %}
                            {{ ui.button(_('Edit Profile'), href=h.url_for('user.edit', id=user_dict.name), style="secondary", class="w-100 mb-2") }}
                        {%- endif %}
                        {{ ui.button(_('Follow'), href=h.url_for('user.follow', id=user_dict.id), style="primary", class="w-100") }}
                    </div>
                </div>
            </div>
        </div>
    </div>
{%- endblock -%}
