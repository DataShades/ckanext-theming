{%- macro organization_item(group) -%}
    {%- do kwargs -%}
    {{ ui.group_item(group, **kwargs) }}
{%- endmacro %}

{%- macro group_item(group) -%}
    {%- do kwargs -%}
    {% set img = group.image_display_url or h.url_for_static('/base/images/placeholder-' ~ ('organization' if group.is_organization else 'group') ~ '.png') %}
    {% set title = group.title or group.name  %}
    {% set body = h.markdown_extract(group.description, 120)|urlize %}

    {{ ui.card(title=title, img=img, body=body, href=h.url_for(('organization' if group.is_organization else 'group') ~ ".read", id=group.name)) }}
{%- endmacro %}


{%- macro package_item(pkg) -%}
    {%- do kwargs -%}
    {% set title = pkg.title or pkg.name  %}
    {% set body = h.markdown_extract(pkg.notes, 120)|urlize %}

    {{ ui.card(title=title, body=body, href=h.url_for(pkg.type ~ ".read", id=pkg.name)) }}
{%- endmacro %}

{%- macro resource_item(res) -%}
    {%- do kwargs -%}
    {% set title = res.name  %}
    {% set body = h.markdown_extract(res.description, 120)|urlize %}

    {{ ui.card(title=title, body=body, href=h.url_for("resource.read", id=res.package_id, resource_id=res.id)) }}
{%- endmacro %}


{%- macro search_form(query, sorting, sorting_options, query_name="q", sorting_name="sort", hidden_filters=[] ) -%}
    {%- set facets = {
            'fields': fields_grouped,
            'search': search_facets,
            'titles': facet_titles,
            'translated_fields': translated_fields,
            'remove_field': remove_field }
    %}

    {%- call ui.util.call(ui.form, **kwargs) -%}
        {{ ui.input(query_name, label=_("Search"), value=query, type="search") }}
        {{ ui.select(sorting_name, label=_("Order by"), selected=sorting, options=sorting_options) if sorting }}
        {{ ui.form_actions(ui.button(_('Search'), type="submit")) }}

        {%- for name, value in hidden_filters -%}
            {{ ui.hidden_input(name, value=value) }}
        {%- endfor %}

    {%- endcall %}
{%- endmacro %}

{%- macro facet_item(key, value, label, count, active) -%}
    {% set url = h.remove_url_param(key, value) if active else h.add_url_param(new_params={key: value}) %}

    {%- call ui.util.call(ui.link, href=url) -%}
        <div style="display: flex; justify-content: space-between;">
            <span>{{ label }}</span>
            <span>{{ "&times;"|safe if active else count }}</span>
        </div>
    {%- endcall %}

{%- endmacro %}

{%- macro facet_group(content, title) -%}
    {%- call ui.util.call(ui.section) -%}
        {{ ui.heading(title, level=3) }}
        {{ content }}
        {{ ui.divider() }}
    {%- endcall %}
{%- endmacro %}
