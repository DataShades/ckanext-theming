{% extends "package/edit_base.html" %}

{% block subtitle %}{{ _('Edit Collaborator') if user else _('Add Collaborator') }} {{ g.template_title_delimiter }} {{ super() }}{% endblock %}

{%- block content_action -%}
    {{ ui.link(_('Back to all collaborators'), h.url_for(pkg_dict.type ~ ".collaborators_read", id=pkg_dict.name)) }}
{%- endblock %}

{%- block primary_content_inner -%}
    {{ ui.heading(_('Edit Collaborator') if user else _('Add Collaborator'), level=1) }}

    {%- call ui.util.form(method="POST") -%}

        {% if not user %}
            <label class="form-label" for="username">
                {{ _('Existing User') }}
            </label>
            <p>
                {{ _('If you wish to add an existing user, search for their username below.') }}
            </p>
        {% endif %}
        <div class="controls">
            {% if user %}
                <input type="hidden" name="username" value="{{ user.name }}" />
                <input id="username" name="username" type="text" value="{{ user.name }}"
                       disabled="True" class="form-control">
            {% else %}
                <input id="username" type="text" name="username" placeholder="{{ _('Username') }}"
                       value="" class="control-medium" data-module="autocomplete"
                       data-module-source="/api/2/util/user/autocomplete?q=?">
            {% endif %}
        </div>



        {% set format_attrs = {'data-module': 'autocomplete'} %}
        {{ form.select('capacity', label=_('Role'), options=capacities, selected=user_capacity, error='', attrs=format_attrs) }}


        {%- call ui.util.call(ui.form_actions) -%}
            {% if user %}
                {%- with form_id = ui.util.id(), modal_id = ui.util.id() -%}
                    {{ ui.modal_handler(_('Delete'), id=modal_id) }}
                    {{ ui.form(method="POST", action=h.url_for(pkg_dict.type ~ '.collaborator_delete', id=pkg_dict.id, user_id=user.name), attrs={"id": form_id}) }}
                    {{ ui.confirm_modal(_('Are you sure you want to delete this collaborator?'), id=modal_id, form_id=form_id) }}
                {%- endwith %}

                {{ ui.button(_('Update  Collaborator'), type="submit") }}

            {% else %}
                {{ ui.button(_('Add Collaborator'), type="submit") }}
            {% endif %}

        {%- endcall %}

    {%- endcall %}
{%- endblock %}


{%- block secondary_content %}
    {{ ui.heading(_('What are the available roles?'), level=2) }}
    {%- set items = [
[_("Editor:"), _("Editors can edit the dataset and its resources, as well accessing the dataset if private.")],
[_("Member:"), _("Members can access the dataset if private, but not edit it.")]
    ] -%}
    {% if h.check_config_permission('allow_admin_collaborators') %}
        {%- set items = [
[_("Admin:"), _("In addition to managing the dataset, admins can add and remove collaborators from a dataset.")]
        ] + items -%}
    {% endif %}

    {{ ui.definition_list(items) }}

{%- endblock %}
