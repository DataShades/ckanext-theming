{% extends "package/_edit_base.html" %}

{%- block subtitle %}
    {{ ui.subtitle_item(_('Collaborators')) }}
    {{ super() }}
{% endblock %}

{%- block content_action -%}
    {{ ui.content_action_item(_('Add Collaborators'), h.url_for(pkg_dict.type ~ ".new_collaborator", id=pkg_dict.name)) if h.check_access('package_collaborator_create', {'id': pkg_dict.id}) }}
{%- endblock %}

{%- block primary_content_inner -%}
    {% set collaborators = h.get_collaborators(pkg_dict.id)%}
    {% set count = collaborators|length %}

    {{ ui.heading(ungettext('{count} collaborator', '{count} collaborators', count).format(count=count), level=3) }}

    {%- call ui.util.call(ui.table, bordered=true) -%}
        {{ ui.table_head(ui.table_row(cells=[_("User"), _("Role"), ""], heading=true)) }}
        {%- call ui.util.call(ui.table_body) -%}
            {% for user_id, capacity in collaborators %}
                {%- call ui.util.call(ui.table_row) -%}
                    {{ ui.table_cell(h.linked_user(user_id, maxlength=20)) }}
                    {{ ui.table_cell(capacity) }}
                    {%- call ui.util.call(ui.table_cell) -%}
                        {%- call ui.util.call(ui.button_group) -%}
                            {{ ui.link(_("Edit role"), h.url_for(pkg_dict.type ~ '.new_collaborator', id=pkg_dict.name, user_id=user_id)) }}

                            {%- with form_id = ui.util.id(), modal_id = ui.util.id() -%}
                                {{ ui.modal_handle(_('Delete collaborator'), id=modal_id) }}
                                {{ ui.form(method="POST", action=h.url_for(pkg_dict.type ~ '.collaborator_delete', id=pkg_dict.name, user_id=user_id), attrs={"id": form_id}) }}
                                {{ ui.confirm_modal(_('Are you sure you want to delete this collaborator?'), id=modal_id, form_id=form_id) }}
                            {%- endwith %}

                        {%- endcall %}
                    {%- endcall %}
                {%- endcall %}
            {%- endfor -%}
        {%- endcall %}
    {%- endcall %}

{%- endblock %}
