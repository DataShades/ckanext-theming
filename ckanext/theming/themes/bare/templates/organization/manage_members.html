{% extends "organization/edit_base.html" %}

{%- block subtitle %}{{ _('Members') }} {{ g.template_title_delimiter }} {{ super() }}{% endblock %}

{%- block page_primary_action %}
    {%- if h.check_access('organization_update', {'id': organization.id}) %}
        {{ ui.link(_('Add Member'), href=h.url_for(group_type ~ '.member_new', id=group_dict.id), class_='btn btn-primary', icon='plus-square') }}
        {{ ui.link(_('CSV'), href=h.url_for(group_type ~ '.member_dump', id=group_dict.id), class_='btn btn-primary', icon='download') }}
    {%- endif %}
{%- endblock %}

{%- block primary_content_inner %}
    {%- set count = members|length %}
    {%- set members_count = ungettext('{count} member', '{count} members', count).format(count=count) %}
    {%- set can_create_members = h.check_access('organization_member_create', {'id': organization.id}) %}
    {%- set can_delete_members = h.check_access('organization_member_delete', {'id': organization.id}) %}
    {{ ui.heading(members_count, level=3, attrs={"class": "page-heading"}) }}
    {{ ui.table_start(attrs={"class": "table table-header table-hover table-bordered"}) }}
        {{ ui.table_head(ui.table_row(cells=[_('User'), _('Role')] + ([_('Actions')] if can_create_members or can_delete_members else []), heading=true)) }}
        {{ ui.table_body(ui.util.map(ui.table_row, [
            ui.table_cell(h.linked_user(user_id, maxlength=20)) +
            ui.table_cell(role) +
            (ui.table_cell(ui.button_group([
                ui.button(_('Edit'), href=h.url_for(group_type ~ '.member_new', id=group_dict.id, user=user_id),
                         style="secondary", size="sm", icon="wrench", attrs={
                             "aria-label": _("Edit role"),
                             "aria-description": _("Edit the role of the user within the organization"),
                             "data-bs-title": _("Edit role"),
                             "data-bs-toggle": "tooltip"}),
                ui.button(_('Delete'), href=h.url_for(group_type ~ '.member_delete', id=group_dict.id, user=user_id),
                         style="danger", size="sm", icon="times", attrs={
                             "aria-label": _("Delete member"),
                             "aria-description": _("Delete this member from the organization"),
                             "data-bs-title": _("Delete member"),
                             "data-bs-toggle": "tooltip",
                             "data-module": "confirm-action",
                             "data-module-content": _("Are you sure you want to delete this member?")
                         })
            ], direction="horizontal", attrs={"class": "pull-right"}) if can_create_members or can_delete_members else "")
            for user_id, user, role in members
        ])) }}
    {{ ui.table_end() }}
{%- endblock %}
