{% extends "organization/read_base.html" %}

{%- block subtitle %}
    {{ ui.subtitle_item(_("Changes")) }}
    {{ super() }}
{% endblock -%}

{%- block breadcrumb_content_selected %}{% endblock %}

{%- block breadcrumb_content %}
    {{ super() }}
    {{ ui.nav_item(_('Changes'), href=h.url_for('activity.organization_activity', id=group_dict.name)) }}
    {{ ui.nav_item(activity_diffs[0].activities[1].id|truncate(30), href=h.url_for('activity.organization_changes', id=activity_diffs[0].activities[1].id), active=true) }}
{%- endblock %}

{%- block primary %}
    <article {{ ui.util.attrs(kwargs) }} class="module">
        <div class="module-content">
            {%- block organization_changes_header %}
                {{ ui.heading(_('Changes'), level=1, class="page-heading") }}
            {%- endblock %}

            {%- set select_list1 = h.activity_list_select(group_activity_list, activity_diffs[-1].activities[0].id) %}
            {%- set select_list2 = h.activity_list_select(group_activity_list, activity_diffs[0].activities[1].id) %}
            {{ ui.form_block("GET", action=h.url_for('activity.organization_changes_multiple'), attrs={"data-module": "select-switch", "data-module-target": ""}) }}
                {{ ui.hidden_input("current_old_id", value=activity_diffs[-1].activities[0].id) }}
                {{ ui.hidden_input("current_new_id", value=activity_diffs[0].activities[1].id) }}
                View changes from
                {{ ui.select("old_id", attrs={"class": "form-control select-time", "form": "range_form"}, options=select_list1[1:], selected=activity_diffs[-1].activities[0].id) }} to
                {{ ui.select("new_id", attrs={"class": "form-control select-time", "form": "range_form"}, options=select_list2, selected=activity_diffs[0].activities[1].id) }}
            {{ ui.form_end() }}

            <br>

            {# Iterate through the list of activity diffs #}
            <hr>
            {%- for i in range(activity_diffs|length) %}
                {{ ui.snippet("organization/snippets/item_organization.html", activity_diff=activity_diffs[i], group_dict=group_dict) }}

                {%- if i == 0 %}
                    {# Button to show JSON metadata diff for the most recent change - not shown by default #}
                    {{ ui.button(_('Show metadata diff'), attrs={
                        "data-module": "metadata-button",
                        "data-module-target": "",
                        "class": "btn",
                        "id": "metadata_button"
                    }) }}
                    <div id="metadata_diff" style="display:none;">
                        {%- block organization_changes_diff %}
                            <pre>
                                {{ activity_diffs[0]['diff']|safe }}
                            </pre>
                        {%- endblock %}
                    </div>
                {%- endif %}

                <hr>
            {%- endfor %}
        </div>
    </article>
{%- endblock %}

{%- block secondary %}{% endblock %}
