{% extends "organization/_edit_base.html" %}

{%- block subtitle %}
    {{ ui.subtitle_item(_('Add Member')) }}
    {{ super() }}
{% endblock %}

{%- block breadcrumb_content %}
    {{ super() }}
    {{ ui.breadcrumb_item(_('Add Member'), href=h.url_for(group_dict.type ~ '.member_new', id=organization_dict.id)) }}
{%- endblock %}

{%- block content_action -%}
    {{ ui.content_action_item(_('Back to all members'), h.url_for(group_dict.type ~ ".manage_members", id=organization_dict.name)) }}
{%- endblock %}


{%- block primary_content_inner %}
    {%- set modal_id = ui.util.id() -%}

    {{ ui.confirm_modal(_('Are you sure you want to delete this member?'), id=modal_id, href=h.url_for(group_dict.type ~ '.member_delete', id=organization_dict.id, user=user_dict.name)) }}

    {{ ui.heading(_('Edit Member') if user_dict else _('Add Member'), level=1) }}

    {%- call ui.util.call(ui.form, method="POST") -%}

        {% if user_dict %}
            {{ ui.input(name="username", label=_("Username"), value=user_dict.name, attrs={"readonly": true}) }}

        {% else %}
            {%- call ui.util.call(ui.autocomplete, name="username", label=_('Existing User'), source="/api/2/util/user/autocomplete") -%}
                {{ _('If you wish to add an existing user, search for their username below.') }}
            {%- endcall %}
        {% endif %}

        {{ ui.select(name='role', label=_('Role'), options=roles, selected=user_role) }}

        {%- call ui.util.call(ui.form_actions) -%}
            {% if user_dict %}
                {{ ui.modal_handle(_('Delete'), id=modal_id) }}

                {{ ui.button(_('Save'), type="submit") }}

            {% else %}
                {{ ui.button(_('Add Member'), type="submit") }}
            {% endif %}

        {%- endcall %}

    {%- endcall %}

{%- endblock %}


{%- block secondary_content %}
    {%- call ui.util.call(ui.sidebar_section, title=_('What are roles?')) -%}
        {{ ui.definition_list([
[_("Admin:"), _("Can add/edit and delete datasets, as well as manage organization members.")],
[_("Editor:"), _("Can add and edit datasets, but not manage organization members.")],
[_("Member:"), _("Can view the organization's private datasets, but not add new datasets.")]
        ]) }}

    {%- endcall %}

{%- endblock %}
