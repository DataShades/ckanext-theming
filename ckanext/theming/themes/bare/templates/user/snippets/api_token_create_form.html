{%- import 'macros/form.html' as form %}

<form hx-post="{{ h.url_for('user.api_tokens', id=user.id ) }}" hx-swap="outerHTML" class="form"
  autocomplete="off"
  {%- if created %}hx-on:htmx:after-settle="document.getElementById('token-{{ created.id }}').scrollIntoView(false)"{%- endif %}>
  {{ h.csrf_input() }}
  {%- block base_fields %}
      <div class="form-group">
          {{ form.input('name', label=_('Name'), is_required=True, value=data.name, error=errors.name) }}
      </div>
  {%- endblock %}
  {%- block form_actions %}
      {{ ui.button(_('Create API Token'), type="submit") }}
  {%- endblock %}
</form>

{%- if created %}
  <template>
    <tbody hx-swap-oob="afterbegin:#api-tokens-table tbody">
      <tr id="token-{{ created.id }}">
        <td colspan="3">
          <div class="form-check">
            <label class="form-check-label radio">
              <input class="form-check-input" type="checkbox" value="{{ created.id }}" name="token"
                onchange="$('#revoke-tokens-button').attr('disabled', !$('[name=token]:checked').length)">
              <code>
                {{ created.name }}
              </code>
            </label>
          </div>
          {{ _("API Token created: <code style=\"word-break:break-all;\">"
               "{token}</code> <br>"
               "Make sure to copy it now, "
               "you won't be able to see it again!").format(
               token=created.token) }}
        </td>
      </tr>
    </tbody>
  </template>
{%- endif %}
